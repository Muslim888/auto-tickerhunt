<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Импорт в Happ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, sans-serif; margin: 40px auto; max-width: 720px; line-height: 1.5; }
    code { word-break: break-all; background: #f4f4f4; padding: 4px 6px; border-radius: 6px; }
    a,button { display:inline-block; margin:10px 0; padding:12px 16px; font-size:16px; border:1px solid #ddd; border-radius:10px; text-decoration:none }
  </style>
</head>
<body>
<h1>Открываем Happ…</h1>
<p id="status">Готовим конфиг…</p>
<pre><code id="cfg"></code></pre>
<p><a id="open" href="#">✈️ Открыть в Happ</a></p>

<script>
(function(){
  var cfg = new URLSearchParams(location.search).get("cfg") || "";
  document.getElementById("cfg").textContent = cfg || "—";
  if(!cfg) { document.getElementById("status").textContent="Нет параметра cfg."; return; }

  try { cfg = decodeURIComponent(cfg); } catch(e){}
  var ua=navigator.userAgent||"", after=cfg.replace(/^vless:\/\//i,"");

  // ссылки на магазины
  var play="https://play.google.com/store/apps/details?id=com.happproxy";
  var appstore="https://apps.apple.com/app/happ-proxy-utility/id6450370275";

  var deeplink, fallback;

  if(/Android/i.test(ua)){
    // Android → запускаем Happ через intent
    deeplink="intent://"+after+"#Intent;scheme=vless;package=com.happproxy;S.browser_fallback_url="+encodeURIComponent(play)+";end";
    fallback=play;
  } else {
    // iOS → прямой vless:// + fallback в App Store
    deeplink=cfg;
    fallback=appstore;
  }

  document.getElementById("open").href=deeplink;
  document.getElementById("status").textContent="Открываем Happ…";

  // Автопереход
  var jumped=false,t=setTimeout(function(){if(!jumped)location.href=fallback;},1800);
  location.href=deeplink;
  window.onblur=function(){jumped=true;clearTimeout(t);};
  document.addEventListener("visibilitychange",function(){if(document.hidden){jumped=true;clearTimeout(t);}});
})();
</script>
</body>
</html>
